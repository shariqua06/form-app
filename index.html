<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accessible Subsidy Application</title>
  <style>
    /* Clean CSS: large buttons, readable fonts, focus states */
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; padding: 20px; background: #f0f4f8; }
    h1 { text-align:center; color: #2c3e50; }
    label { display:block; margin: 15px 0 5px; font-weight:bold; }
    input, textarea, select { width: 100%; padding: 10px; font-size: 1.1em; border-radius: 5px; border: 1.2px solid #ccc; }
    button { background: #2980b9; color: white; border:none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 1em; margin-top: 10px; }
    button.recording { background: #c0392b; }
    .row { display: flex; align-items: center; gap: 12px; }
    .row > input, .row > select, .row > textarea { flex-grow: 1; }
    .language-select { margin-bottom: 20px; }
    #canvas { display: none; max-width: 100%; margin-top: 10px; border: 2px solid #555; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>ро╡ро┐ро╡роЪро╛ропро┐ роЙродро╡ро┐ ро╡ро┐рогрпНрогрокрпНрокроорпН</h1>

  <div class="language-select">
    <label for="lang">Select Voice Guidance Language / роорпКро┤ро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН:</label>
    <select id="lang">
      <option value="ta-IN">родрооро┐ро┤рпН (Tamil)</option>
      <option value="en-US">English</option>
    </select>
  </div>

  <form id="form">
    <div class="row">
      <label for="name">Name / рокрпЖропро░рпН</label>
      <input type="text" id="name" name="name" autocomplete="off" />
      <button type="button" id="btnName">ЁЯОд Start</button>
    </div>

    <div class="row">
      <label for="location">Farm Location / рокрогрпНрогрпИ роЗро░рпБрокрпНрокро┐роЯроорпН</label>
      <input type="text" id="location" name="location" autocomplete="off" />
      <button type="button" id="btnLocation">ЁЯОд Start</button>
    </div>

    <div class="row">
      <label for="account">Bank Account Number / ро╡роЩрпНроХро┐ роХрогроХрпНроХрпБ роОрогрпН (Camera Capture)</label>
      <input type="text" id="account" name="account" readonly />
      <button type="button" id="btnCaptureAccount">ЁЯУ╖ Capture</button>
    </div>

    <video id="video" width="320" height="240" autoplay playsinline style="display:none; border:1px solid #ccc; margin-top:10px;"></video>
    <canvas id="canvas" width="320" height="240"></canvas>

    <div class="row">
      <label for="subsidy">Subsidy Type / роЙродро╡ро┐ ро╡роХрпИ</label>
      <input type="text" id="subsidy" name="subsidy" autocomplete="off" />
      <button type="button" id="btnSubsidy">ЁЯОд Start</button>
    </div>

    <div class="row">
      <label for="desc">Description / ро╡ро┐ро╡ро░роорпН</label>
      <textarea id="desc" name="desc" rows="4"></textarea>
      <button type="button" id="btnDesc">ЁЯОд Start</button>
    </div>

    <button type="submit">Submit / роЪрооро░рпНрокрпНрокро┐роХрпНроХро╡рпБроорпН</button>
  </form>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

<script>
  const langSelect = document.getElementById('lang');
  const form = document.getElementById('form');
  const recognizers = {};

  function speak(text) {
    const lang = langSelect.value || 'ta-IN';
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    speechSynthesis.speak(utterance);
  }

  function toggleRecognition(fieldId, btn) {
    if (!('webkitSpeechRecognition' in window)) {
      alert('Speech recognition not supported');
      return;
    }
    if (recognizers[fieldId]) {
      recognizers[fieldId].stop();
      btn.textContent = 'ЁЯОд Start';
      btn.classList.remove('recording');
      delete recognizers[fieldId];
      return;
    }
    // voice guidance before start
    const instructions = {
      name: {'ta-IN': 'родропро╡рпБ роЪрпЖропрпНродрпБ роЙроЩрпНроХро│рпН рокрпЖропро░рпИ роЪрпКро▓рпНро▓ро╡рпБроорпН.', 'en-US': 'Please say your name.' },
      location: {'ta-IN': 'рокрогрпНрогрпИропро┐ройрпН роЗро░рпБрокрпНрокро┐роЯродрпНродрпИ роЪрпКро▓рпНро▓ро╡рпБроорпН.', 'en-US': 'Please say your farm location.'},
      subsidy: {'ta-IN': 'роЙродро╡ро┐ ро╡роХрпИропрпИ роЪрпКро▓рпНро▓ро╡рпБроорпН.', 'en-US': 'Please say the subsidy type.'},
      desc: {'ta-IN': 'роХрпВроЯрпБродро▓рпН ро╡ро┐ро╡ро░роЩрпНроХро│рпИ роЪрпКро▓рпНро▓ро╡рпБроорпН.', 'en-US': 'Please say additional details.'}
    };
    const instr = instructions[fieldId][langSelect.value] || instructions[fieldId]['ta-IN'];
    speak(instr);

    const recognition = new webkitSpeechRecognition();
    recognition.lang = langSelect.value;
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.start();

    btn.textContent = 'тП╣ Stop';
    btn.classList.add('recording');
    recognizers[fieldId] = recognition;

    recognition.onresult = (e) => {
      const text = e.results[0][0].transcript;
      document.getElementById(fieldId).value = text;
    };
    recognition.onerror = (e) => {
      alert('Error: ' + e.error);
      btn.textContent = 'ЁЯОд Start';
      btn.classList.remove('recording');
      delete recognizers[fieldId];
    };
    recognition.onend = () => {
      btn.textContent = 'ЁЯОд Start';
      btn.classList.remove('recording');
      delete recognizers[fieldId];
      // Automatically guide next? Optional.
    };
  }

  ['Name', 'Location', 'Subsidy', 'Desc'].forEach(field => {
    const btn = document.getElementById('btn' + field);
    const fieldId = field.toLowerCase();
    btn.onclick = () => toggleRecognition(fieldId, btn);
  });

  // Camera capture and OCR for bank account number
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const accountInput = document.getElementById('account');
  const captureBtn = document.getElementById('btnCaptureAccount');
  let stream;

  async function startCamera() {
    if (!stream) {
      stream = await navigator.mediaDevices.getUserMedia({video: { facingMode: 'environment' }});
      video.srcObject = stream;
      video.style.display = 'block';
      canvas.style.display = 'none';
    }
  }

  captureBtn.onclick = async () => {
    if (video.style.display === 'none') {
      await startCamera();
      speak(langSelect.value === 'en-US' ? 'Please show your bank account number to the camera.' : 'родропро╡рпБ роЪрпЖропрпНродрпБ ро╡роЩрпНроХро┐ роХрогроХрпНроХрпБ роОрогрпНрогрпИ роХрпЗрооро░ро╛роХрпНроХрпБ роХро╛роЯрпНроЯро╡рпБроорпН.');
      return;
    }
    // Capture photo from video
    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
    canvas.style.display = 'block';
    video.style.display = 'none';
    stream.getTracks().forEach(track => track.stop());
    stream = null;

    speak(langSelect.value === 'en-US' ? 'Processing image, please wait.' : 'рокроЯродрпНродрпИ роЪрпЖропро▓ро╛роХрпНроХрпБроХро┐ро▒родрпБ, роХро╛родрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН.');

    // OCR with Tesseract.js
    const { data: { text } } = await Tesseract.recognize(canvas.toDataURL(), langSelect.value === 'en-US' ? 'eng' : 'tam');

    const cleaned = text.replace(/s/g, '').replace(/[^d]/g, '').substring(0,30); // Remove spaces, letters, limit length
    accountInput.value = cleaned;

    speak(langSelect.value === 'en-US' ? 'Bank account number detected and entered.' : 'ро╡роЩрпНроХро┐ роХрогроХрпНроХрпБ роОрогрпН роХрогрпНроЯро▒ро┐ропрпБроорпН роЪрпЖропрпНродрпБ роЙро│рпНро│ро┐роЯрокрпНрокроЯрпНроЯродрпБ.');
  };

  form.onsubmit = (e) => {
    e.preventDefault();
    speak(langSelect.value === 'en-US' ? 'Your application has been submitted. Thank you!' : 'роЙроЩрпНроХро│рпН ро╡ро┐рогрпНрогрокрпНрокроорпН роЪрооро░рпНрокрпНрокро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ. роиройрпНро▒ро┐!');
    alert(`Form Submitted!
Name: ${form.name.value}
Location: ${form.location.value}
Bank Account: ${form.account.value}
Subsidy: ${form.subsidy.value}
Description: ${form.desc.value}`);
  };
</script>
</body>
</html>
