<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Accessible Subsidy Application</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 700px; margin:20px auto; padding:20px; background:#f0f4f8; }
  h1 { text-align:center; color:#2c3e50; }
  label { display:block; margin:15px 0 5px; font-weight:bold; width: 150px; }
  input, textarea, select { flex-grow:1; padding: 10px; font-size: 1.1em; border-radius:5px; border:1.2px solid #ccc; }
  button { background:#2980b9; color:white; border:none; padding:10px 15px; border-radius:6px; cursor:pointer; font-size:1em; }
  button.recording { background:#c0392b; }
  button:hover { filter: brightness(0.9); }
  .row { display: flex; align-items: center; gap:12px; margin-bottom: 15px; }
  .language-select { margin-bottom: 20px; }
  #canvas { display:none; max-width: 100%; margin-top: 10px; border: 2px solid #555; border-radius: 6px; }
  #video { display: none; border: 1px solid #ccc; border-radius: 6px; margin-top: 10px; max-width: 100%; }
</style>
</head>
<body>
<h1>ро╡ро┐ро╡роЪро╛ропро┐ роЙродро╡ро┐ ро╡ро┐рогрпНрогрокрпНрокроорпН</h1>
<div class="language-select">
  <label for="lang">Select Voice Guidance Language / роорпКро┤ро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН:</label>
  <select id="lang" disabled>
    <option value="ta-IN" selected>родрооро┐ро┤рпН (Tamil)</option>
  </select>
</div>
<form id="form">
  <div class="row">
    <label for="name">Name / рокрпЖропро░рпН</label>
    <input type="text" id="name" name="name" autocomplete="off" />
    <button type="button" id="btnNamePlay">ЁЯФК Play</button>
    <button type="button" id="btnNameRec">ЁЯОд Speak</button>
  </div>
  <div class="row">
    <label for="location">Farm Location / рокрогрпНрогрпИ роЗро░рпБрокрпНрокро┐роЯроорпН</label>
    <input type="text" id="location" name="location" autocomplete="off" />
    <button type="button" id="btnLocationPlay">ЁЯФК Play</button>
    <button type="button" id="btnLocationRec">ЁЯОд Speak</button>
  </div>
  <div class="row">
    <label for="account">Bank Account Number / ро╡роЩрпНроХро┐ роХрогроХрпНроХрпБ роОрогрпН (Camera Capture)</label>
    <input type="text" id="account" name="account" readonly />
    <button type="button" id="btnCaptureAccount">ЁЯУ╖ Capture</button>
  </div>
  <video id="video" width="320" height="240" autoplay playsinline></video>
  <canvas id="canvas" width="320" height="240"></canvas>
  <div class="row">
    <label for="subsidy">Subsidy Type / роЙродро╡ро┐ ро╡роХрпИ</label>
    <input type="text" id="subsidy" name="subsidy" autocomplete="off" />
    <button type="button" id="btnSubsidyPlay">ЁЯФК Play</button>
    <button type="button" id="btnSubsidyRec">ЁЯОд Speak</button>
  </div>
  <div class="row">
    <label for="desc">Description / ро╡ро┐ро╡ро░роорпН</label>
    <textarea id="desc" name="desc" rows="4"></textarea>
    <button type="button" id="btnDescPlay">ЁЯФК Play</button>
    <button type="button" id="btnDescRec">ЁЯОд Speak</button>
  </div>
  <button type="submit">Submit / роЪрооро░рпНрокрпНрокро┐роХрпНроХро╡рпБроорпН</button>
</form>

<!-- Audio elements -->
<audio id="audioName" src="https://drive.google.com/uc?export=download&id=1SrOuGA2r2IFrvLN1gKG9Jbv6vB_SLPN0" preload="none"></audio>
<audio id="audioLocation" src="https://drive.google.com/uc?export=download&id=1pGKF-BnqdbjtZprM-ZRMJV7rQ_oP1NSv" preload="none"></audio>
<audio id="audioSubsidy" src="https://drive.google.com/uc?export=download&id=1psRUf9gCS0HqGIyEzqmuvbooG0wWQ8FL" preload="none"></audio>
<audio id="audioDesc" src="https://drive.google.com/uc?export=download&id=1kgJbi7hdhgx1QxSar2uJ2yxlrWcmmEDe" preload="none"></audio>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<script>
  // Play uploaded Tamil voice recording on play button click
  function playPreRecordedAudio(audioId) {
    document.querySelectorAll('audio').forEach(audio => {
      audio.pause();
      audio.currentTime = 0;
    });
    const audioToPlay = document.getElementById(audioId);
    if (audioToPlay) audioToPlay.play();
  }

  // Speech recognition setup
  function startSpeechRecognition(inputId, btn) {
    if (!('webkitSpeechRecognition' in window)) {
      alert('Speech recognition not supported');
      return;
    }
    let recognition = new webkitSpeechRecognition();
    recognition.lang = 'ta-IN';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.start();
    btn.textContent = 'ЁЯЫС Stop';
    recognition.onresult = (e) => {
      const text = e.results[0][0].transcript;
      document.getElementById(inputId).value = text;
    };
    recognition.onerror = () => {
      btn.textContent = 'ЁЯОд Speak';
    };
    recognition.onend = () => {
      btn.textContent = 'ЁЯОд Speak';
    };
  }

  // Bind play buttons
  document.getElementById('btnNamePlay').onclick = () => playPreRecordedAudio('audioName');
  document.getElementById('btnLocationPlay').onclick = () => playPreRecordedAudio('audioLocation');
  document.getElementById('btnSubsidyPlay').onclick = () => playPreRecordedAudio('audioSubsidy');
  document.getElementById('btnDescPlay').onclick = () => playPreRecordedAudio('audioDesc');

  // Bind speech recognition buttons
  document.getElementById('btnNameRec').onclick = function() { startSpeechRecognition('name', this); };
  document.getElementById('btnLocationRec').onclick = function() { startSpeechRecognition('location', this); };
  document.getElementById('btnSubsidyRec').onclick = function() { startSpeechRecognition('subsidy', this); };
  document.getElementById('btnDescRec').onclick = function() { startSpeechRecognition('desc', this); };

  // Camera capture for Bank Account OCR
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const accountInput = document.getElementById('account');
  const captureBtn = document.getElementById('btnCaptureAccount');
  let stream;

  async function startCamera() {
    if (!stream) {
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
      video.srcObject = stream;
      video.style.display = 'block';
      canvas.style.display = 'none';
    }
  }

  captureBtn.onclick = async () => {
    if (video.style.display === 'none') {
      await startCamera();
      return;
    }
    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
    canvas.style.display = 'block';
    video.style.display = 'none';
    if(stream) {
      stream.getTracks().forEach(track => track.stop());
      stream = null;
    }
    const { data: { text } } = await Tesseract.recognize(canvas.toDataURL(), 'tam');
    const cleaned = text.replace(/D/g, '').substring(0, 30);
    accountInput.value = cleaned;
  };

  document.getElementById('form').onsubmit = (e) => {
    e.preventDefault();
    alert(`Form Submitted!
Name: ${e.target.name.value}
Location: ${e.target.location.value}
Bank Account: ${e.target.account.value}
Subsidy: ${e.target.subsidy.value}
Description: ${e.target.desc.value}`);
  };
</script>
</body>
</html>
