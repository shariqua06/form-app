<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Farmer Subsidy Application – AI Form Filler</title>
<link href="https://fonts.googleapis.com/css2?family=Material+Icons&family=Inter:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', Arial, sans-serif;
  background: linear-gradient(135deg, #f7ffe0 0%, #e0e7ff 100%);
  color: #1e2539;
  min-height: 100vh;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.container {
  background: #fff;
  border-radius: 20px;
  width: 100%;
  max-width: 520px;
  padding: 28px 20px 38px 20px;
  box-shadow: 0 8px 32px rgba(112, 144, 176, 0.18);
}
h2 {
  text-align: center;
  color: #4f46e5;
  letter-spacing: 1.2px;
  margin-bottom: 0.35em;
}
.subtitle {
  text-align: center;
  color: #888da8;
  font-size: 1rem;
  margin: 0 0 16px 0;
}
#progressBar {
  width: 100%;
  margin: 12px 0 20px 0;
  background: #f1f5f9;
  border-radius: 8px;
  height: 7px;
  overflow: hidden;
}
#progressBar span {
  display: block;
  height: 100%;
  background: linear-gradient(90deg, #7a88ff, #48bee5);
  width: 0%;
  transition: width 0.4s;
}
.field-label {
  font-weight: 600;
  font-size: 1.03em;
  margin-bottom: 4px;
  display: flex;
  align-items: center;
  gap: 7px;
}
input, select {
  width: 100%;
  border: 2px solid #e3e7f4;
  background: #fafdff;
  font-size: 1em;
  border-radius: 11px;
  padding: 12px 14px;
  margin-bottom: 10px;
  transition: border 0.2s;
}
input:focus, select:focus {
  border-color: #7a88ff;
  outline: none;
  background: #f6fafd;
  box-shadow: 0 2px 8px rgba(120, 130, 255, 0.12);
}
.field-row {
  display: flex;
  gap: 7px;
  margin-bottom: 8px;
  align-items: flex-start;
}
.icon {
  font-family: 'Material Icons';
  font-weight: normal;
  font-style: normal;
  font-size: 1.35em;
  color: #48bee5;
  vertical-align: bottom;
}
.voice-btn {
  background: #ebe6ff;
  color: #523ae8;
  border-radius: 50%;
  padding: 0.5em;
  width: 36px;
  height: 36px;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 20px;
  margin-left: 7px;
  transition: background 0.2s;
}
.voice-btn:active { background: #d8d6fa; }
.voice-btn[aria-busy='true'] { background: #ffeaa7; color: #e67e22; }
.hint {
  font-size: 0.96em;
  color: #96a1be;
  margin-top: 3px;
  margin-bottom: 7px;
  display: flex;
  gap: 6px;
  align-items: center;
}
#video {
  width: 100%;
  border-radius: 14px;
  margin-top: 10px;
  margin-bottom: 6px;
  background: #eee;
  min-height: 135px;
  object-fit: cover;
  border: 2px solid #e0e7ff;
}
#aadhaarNumber[readonly] {
  font-weight: 600;
  background: #f4f8ff;
}
.submit-btn {
  width: 100%;
  padding: 13px;
  color: #fff;
  background: #4f46e5;
  border-radius: 12px;
  border: none;
  font-size: 1.1em;
  font-weight: 700;
  margin-top: 18px;
  cursor: pointer;
}
.submit-btn:hover { background: #644bfd; }
.num-keypad {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin-bottom: 10px;
}
.num-keypad button {
  flex: 1 0 30%;
  padding: 10px;
  font-size: 16px;
  border-radius: 6px;
  border: 1px solid #ccc;
  background: #f0f0ff;
  cursor: pointer;
}
.num-keypad button:active { background: #d0d0ff; }
@media (max-width: 520px) {
  .container { max-width: 97vw; padding: 10px; border-radius: 12px;}
  #video { min-height: 80px; }
}
</style>
</head>
<body>
<div class="container" aria-label="Farmer Subsidy Application Form">
<h2>Farmer Subsidy Application</h2>
<div class="subtitle">Easy voice, camera, and keypad entry. Tamil prompts + icons for illiterate users.</div>
<div id="progressBar" aria-hidden="true"><span></span></div>
<form id="form" autocomplete="off">
  <!-- Name -->
  <div class="field-row">
    <div style="flex:1;">
      <label class="field-label" for="name"><span class="icon">person</span>Name</label>
      <input id="name" placeholder="Enter Name" autocomplete="off" required/>
    </div>
    <button type="button" class="voice-btn" aria-label="Voice input name" id="voiceName"><span class="icon">mic</span></button>
  </div>

  <!-- Farm Location -->
  <div class="field-row">
    <div style="flex:1;">
      <label class="field-label" for="location"><span class="icon">location_on</span>Farm Location</label>
      <input id="location" placeholder="Enter Farm Location" autocomplete="off" required/>
    </div>
    <button type="button" class="voice-btn" aria-label="Voice input location" id="voiceLocation"><span class="icon">mic</span></button>
  </div>

  <!-- Subsidy Type -->
  <div class="field-row">
    <div style="flex:1;">
      <label class="field-label" for="subsidyType"><span class="icon">agriculture</span>Subsidy Type</label>
      <select id="subsidyType" required>
        <option value="">-- Select Subsidy --</option>
        <option value="urimam">Urimam (Fertilizer)</option>
        <option value="parivu">Parivu (Irrigation)</option>
        <option value="vidhai">Vidhai (Seed)</option>
        <option value="ubagaranam">Ubagaranam (Equipment)</option>
      </select>
    </div>
    <button type="button" class="voice-btn" aria-label="Voice input subsidy type" id="voiceSubsidy"><span class="icon">mic</span></button>
  </div>

  <!-- Amount -->
  <div class="field-row">
    <div style="flex:1;">
      <label class="field-label" for="amount"><span class="icon">payments</span>Amount</label>
      <input id="amount" placeholder="Enter Amount" inputmode="numeric" pattern="[0-9]*" required/>
      <div class="num-keypad" id="numKeypad"></div>
    </div>
    <button type="button" class="voice-btn" aria-label="Voice input amount" id="voiceAmount"><span class="icon">mic</span></button>
  </div>

  <!-- Aadhaar Card -->
  <div style="margin:17px 0 0 0;">
    <label class="field-label" for="aadhaarNumber"><span class="icon">credit_card</span>Aadhaar Card</label>
    <video id="video" autoplay playsinline muted></video>
    <div class="hint" aria-live="polite"><span class="icon">fact_check</span>Hold card steady; number will auto-fill.</div>
    <input id="aadhaarNumber" placeholder="Aadhaar Number auto-filled" readonly/>
    <div class="hint" id="cameraError" style="color:#b91c1c; display:none;"><span class="icon" style="color:#b91c1c;">warning</span>Camera not available or permission denied. Enter Aadhaar manually if needed.</div>
    <div class="hint" id="bankLink" style="color:#15803d; display:none;"><span class="icon" style="color:#15803d;">check_circle</span>Bank linked successfully (dummy)</div>
  </div>

  <button type="submit" class="submit-btn" id="submit">Submit Form</button>
</form>
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script>
// ===== Progress Bar =====
function setProgress(val){document.querySelector("#progressBar span").style.width=val+"%";}
setProgress(13);
["name","location","subsidyType","amount","aadhaarNumber"].forEach(function(id,i){
  document.getElementById(id).addEventListener("focus",function(){setProgress((i+1)*20);});
});

// ===== Numeric Keypad =====
const numKeypad=document.getElementById("numKeypad");
const amountInput=document.getElementById("amount");
[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
  const b=document.createElement("button");
  b.type="button"; b.textContent=n;
  b.onclick=()=>amountInput.value+=n;
  numKeypad.appendChild(b);
});

// ===== Camera + OCR =====
const video=document.getElementById("video");
const aadhaarInput=document.getElementById("aadhaarNumber");
const cameraError=document.getElementById("cameraError");
const bankLink=document.getElementById("bankLink");
const canvas=document.createElement("canvas");
const ctx=canvas.getContext("2d");
let worker,ocrReady=false,cameraAvailable=true;

async function initOCR(){
  worker=Tesseract.createWorker();
  await worker.load();
  await worker.loadLanguage("eng");
  await worker.initialize("eng");
  ocrReady=true;
}
initOCR();

async function startCamera(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
    video.srcObject=stream;
    cameraAvailable=true;
    video.style.display="block";
    cameraError.style.display="none";
  }catch(e){
    cameraAvailable=false;
    video.style.display="none";
    cameraError.style.display="block";
    console.warn("Camera access denied:",e);
  }
}
startCamera();

async function scanFrame(){
  if(ocrReady && cameraAvailable && video.readyState===4){
    canvas.width=video.videoWidth;
    canvas.height=video.videoHeight;
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    const dataURL=canvas.toDataURL("image/png");
    try{
      const {data}=await worker.recognize(dataURL);
      const match=data.text.match(/\b\d{4}\s*\d{4}\s*\d{4}\b/);
      if(match){
        const num=match[0].replace(/\s/g,"");
        if(aadhaarInput.value!==num){
          aadhaarInput.value=num;
          bankLink.style.display="block"; // dummy bank linked
        }
      }
    }catch(err){console.error("OCR error",err);}
  }
  requestAnimationFrame(scanFrame);
}
requestAnimationFrame(scanFrame);

// ===== Tamil Audio + Voice Recognition =====
const voiceLinks = {
  name: "https://drive.google.com/uc?export=download&id=1SrOuGA2r2IFrvLN1gKG9Jbv6vB_SLPN0",
  location: "https://drive.google.com/uc?export=download&id=1pGKF-BnqdbjtZprM-ZRMJV7rQ_oP1NSv",
  subsidy: "https://drive.google.com/uc?export=download&id=1psRUf9gCS0HqGIyEzqmuvbooG0wWQ8FL",
  amount: "https://drive.google.com/uc?export=download&id=1kgJbi7hdhgx1QxSar2uJ2yxlrWcmmEDe"
};

function playTamilThenEnglish(tamilLink, inputId){
  const audio=new Audio(tamilLink);
  audio.play();
  audio.onended=()=>{
    const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
    if(!SpeechRecognition){ alert("Speech not supported"); return; }
    const recognition=new SpeechRecognition();
    recognition.lang='en-IN';
    recognition.onresult=e=>{ document.getElementById(inputId).value=e.results[0][0].transcript; recognition.stop(); };
    recognition.onerror=()=>{ recognition.stop(); };
    recognition.start();
  }
}

document.getElementById("voiceName").onclick=()=>playTamilThenEnglish(voiceLinks.name,"name");
document.getElementById("voiceLocation").onclick=()=>playTamilThenEnglish(voiceLinks.location,"location");
document.getElementById("voiceSubsidy").onclick=()=>playTamilThenEnglish(voiceLinks.subsidy,"subsidyType");
document.getElementById("voiceAmount").onclick=()=>playTamilThenEnglish(voiceLinks.amount,"amount");

// ===== Form Submit =====
document.getElementById("form").onsubmit=e=>{
  e.preventDefault();
  function borderErr(id){ const el=document.getElementById(id); el.style.borderColor="#ee2929"; setTimeout(()=>el.style.borderColor="",1800);}
  let isValid=true;
  ["name","location","subsidyType","amount","aadhaarNumber"].forEach(function(id){ if(!document.getElementById(id).value){ borderErr(id); isValid=false;} });
  if(!isValid){alert("Please fill all required fields."); return;}
  alert(
    "Form Submitted!\n"+
    "Name: "+document.getElementById("name").value+"\n"+
    "Location: "+document.getElementById("location").value+"\n"+
    "Subsidy: "+document.getElementById("subsidyType").value+"\n"+
    "Amount: "+document.getElementById("amount").value+"\n"+
    "Aadhaar: "+document.getElementById("aadhaarNumber").value+"\n"+
    "Bank linked (dummy) ✅"
  );
  document.getElementById("form").reset();
  setProgress(13);
  aadhaarInput.value="";
  bankLink.style.display="none";
  document.activeElement.blur();
};
</script>
</body>
</html>
