<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Subsidy Application</title>
<style>
  body {
    font-family: Arial, sans-serif; max-width: 700px;
    margin: 20px auto; padding: 20px;
    background: #f0f4f8;
  }
  h1 {
    text-align: center; color: #2c3e50;
  }
  label {
    font-weight: bold; margin-bottom: 6px; display: block;
  }
  .row {
    display: flex; gap: 12px; align-items: center;
    margin-bottom: 16px;
  }
  input, textarea, select {
    flex-grow: 1; padding: 10px; font-size: 1rem;
    border-radius: 5px; border: 1.2px solid #ccc;
  }
  textarea {
    resize: vertical;
  }
  button {
    background-color: #2980b9; color: white; border: none;
    border-radius: 6px; padding: 10px 18px; cursor: pointer;
    font-size: 1rem;
  }
  button:hover {
    filter: brightness(0.9);
  }
  #video, #canvas {
    display: none; margin-top: 10px;
    border-radius: 6px; max-width: 100%;
  }
  #canvas {
    border: 2px solid #555;
  }
</style>
</head>
<body>
<h1>ро╡ро┐ро╡роЪро╛ропро┐ роЙродро╡ро┐ ро╡ро┐рогрпНрогрокрпНрокроорпН</h1>

<label for="lang">Select Guidance Language:</label>
<select id="lang">
  <option value="ta-IN" selected>родрооро┐ро┤рпН (Tamil)</option>
  <option value="en-US">English</option>
</select>

<form id="form">
  <div class="row">
    <label for="name">Name / рокрпЖропро░рпН</label>
    <input type="text" id="name" name="name" autocomplete="off" />
    <button type="button" id="btnNamePlay">ЁЯФК Play</button>
    <button type="button" id="btnNameRec">ЁЯОд Speak</button>
  </div>

  <div class="row">
    <label for="location">Farm Location / рокрогрпНрогрпИ роЗро░рпБрокрпНрокро┐роЯроорпН</label>
    <input type="text" id="location" name="location" autocomplete="off" />
    <button type="button" id="btnLocationPlay">ЁЯФК Play</button>
    <button type="button" id="btnLocationRec">ЁЯОд Speak</button>
  </div>

  <div class="row">
    <label for="account">Bank Account Number / ро╡роЩрпНроХро┐ роХрогроХрпНроХрпБ роОрогрпН (Camera Capture)</label>
    <input type="text" id="account" name="account" readonly />
    <button type="button" id="btnCaptureAccount">ЁЯУ╖ Capture</button>
  </div>
  <video id="video" width="320" height="240" autoplay playsinline></video>
  <canvas id="canvas" width="320" height="240"></canvas>

  <div class="row">
    <label for="subsidy">Subsidy Type / роЙродро╡ро┐ ро╡роХрпИ</label>
    <input type="text" id="subsidy" name="subsidy" autocomplete="off" />
    <button type="button" id="btnSubsidyPlay">ЁЯФК Play</button>
    <button type="button" id="btnSubsidyRec">ЁЯОд Speak</button>
  </div>

  <div class="row">
    <label for="desc">Description / ро╡ро┐ро╡ро░роорпН</label>
    <textarea id="desc" name="desc" rows="4"></textarea>
    <button type="button" id="btnDescPlay">ЁЯФК Play</button>
    <button type="button" id="btnDescRec">ЁЯОд Speak</button>
  </div>

  <button type="submit">Submit / роЪрооро░рпНрокрпНрокро┐роХрпНроХро╡рпБроорпН</button>
</form>

<!-- Tamil audio files -->
<audio id="audioNameTa" src="https://drive.google.com/uc?export=download&id=1SrOuGA2r2IFrvLN1gKG9Jbv6vB_SLPN0" preload="none"></audio>
<audio id="audioLocationTa" src="https://drive.google.com/uc?export=download&id=1pGKF-BnqdbjtZprM-ZRMJV7rQ_oP1NSv" preload="none"></audio>
<audio id="audioSubsidyTa" src="https://drive.google.com/uc?export=download&id=1psRUf9gCS0HqGIyEzqmuvbooG0wWQ8FL" preload="none"></audio>
<audio id="audioDescTa" src="https://drive.google.com/uc?export=download&id=1kgJbi7hdhgx1QxSar2uJ2yxlrWcmmEDe" preload="none"></audio>

<!-- English audio files -->
<!-- Replace URLs below with your actual English mp3 URLs -->
<audio id="audioNameEn" src="YOUR_ENGLISH_NAME_AUDIO_MP3_URL" preload="none"></audio>
<audio id="audioLocationEn" src="YOUR_ENGLISH_LOCATION_AUDIO_MP3_URL" preload="none"></audio>
<audio id="audioSubsidyEn" src="YOUR_ENGLISH_SUBSIDY_AUDIO_MP3_URL" preload="none"></audio>
<audio id="audioDescEn" src="YOUR_ENGLISH_DESC_AUDIO_MP3_URL" preload="none"></audio>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<script>
  const langSelect = document.getElementById('lang');
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const accountInput = document.getElementById('account');
  let stream;

  function getLangSuffix(){
    return langSelect.value.startsWith('ta') ? 'Ta' : 'En';
  }

  function playAudio(field) {
    const langSuffix = getLangSuffix();
    document.querySelectorAll('audio').forEach(audio=>{
      audio.pause();
      audio.currentTime=0;
    });
    const audio = document.getElementById(audio${field}${langSuffix});
    if(audio){
      audio.play().catch(e=>{
        console.error('Audio play failed:', e);
        alert('Audio playback failed, please check your link or browser permissions.');
      });
    } else {
      alert('Audio file for this field does not exist in selected language.');
    }
  }

  function startSpeechRecognition(fieldId, btn){
    if(!('webkitSpeechRecognition' in window)){
      alert('Speech Recognition not supported in this browser.');
      return;
    }
    const recognition = new webkitSpeechRecognition();
    recognition.lang = langSelect.value;
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    btn.disabled = true;
    btn.textContent = 'ЁЯЫС Listening...';

    recognition.onresult = e=>{
      document.getElementById(fieldId).value = e.results[0][0].transcript;
    };

    recognition.onerror = e=>{
      console.error('Speech recognition error:', e);
      btn.textContent = 'ЁЯОд Speak';
      btn.disabled = false;
      alert('Speech recognition failed or was interrupted.');
    };

    recognition.onend = ()=>{
      btn.textContent = 'ЁЯОд Speak';
      btn.disabled = false;
    };

    recognition.start();
  }

  async function startCamera(){
    try {
      if(!stream){
        stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
        video.srcObject = stream;
        video.style.display = 'block';
        canvas.style.display = 'none';
      }
    } catch (e) {
      alert('Camera permission denied or not available');
    }
  }

  async function captureAccount(){
    if(video.style.display==='none'){
      await startCamera();
      alert(langSelect.value.startsWith('ta') ? 'Please show your bank account number to the camera.' : 'Please show your bank account number to the camera.');
      return;
    }
    canvas.getContext('2d').drawImage(video,0,0,canvas.width,canvas.height);
    canvas.style.display = 'block';
    video.style.display = 'none';
    if(stream){
      stream.getTracks().forEach(track=>track.stop());
      stream=null;
    }

    try{
      const {data: {text}} = await Tesseract.recognize(canvas.toDataURL(), langSelect.value.startsWith('ta') ? 'tam' : 'eng');
      const cleaned = text.replace(/D/g,'').substring(0,30);
      accountInput.value = cleaned;
    }catch(e){
      alert('OCR failed, please try again.');
    }
  }

  ['Name','Location','Subsidy','Desc'].forEach(field=>{
    document.getElementById(btn${field}Play).addEventListener('click',()=>playAudio(field));
    document.getElementById(btn${field}Rec).addEventListener('click',function(){
      startSpeechRecognition(field.toLowerCase(),this);
    });
  });

  document.getElementById('btnCaptureAccount').addEventListener('click',captureAccount);

  document.getElementById('form').onsubmit = e=>{
    e.preventDefault();
    const f=e.target;
    alert(`Form Submitted:
Name: ${f.name.value}
Farm Location: ${f.location.value}
Bank Account: ${f.account.value}
Subsidy Type: ${f.subsidy.value}
Description: ${f.desc.value}`);
  };
</script>
</body>
</html>
